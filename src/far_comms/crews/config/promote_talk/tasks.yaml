analyze_transcript_task:
  description: >
    Analyze {speaker}'s talk transcript to extract core findings, technical details, and key insights.
    ===
    transcript: 
    {transcript}
    ===
    Your analysis should:
    - Identify the main thesis and supporting arguments
    - Extract specific technical details, numbers, and metrics
    - Find surprising or counterintuitive claims
    - Collect impactful direct quotes from the speaker
    - Note the speaker's communication style and tone
    - Highlight key findings that would interest both technical and non-technical audiences
  expected_output: >
    {
      "core_thesis": "Main argument in 1 sentence",
      "key_findings": ["Finding 1", "Finding 2", "Finding 3"],
      "technical_details": {"metrics": ["...", "..."], "methods": ["...", "..."], "numbers": ["...", "..."]},
      "surprising_claims": ["Counterintuitive insight 1", "Counterintuitive insight 2"],
      "impactful_quotes": ["Direct quote 1", "Direct quote 2"],
      "speaker_voice": "Description of communication style and tone characteristics"
    }
  agent: transcript_analyzer_agent

generate_hooks_task:
  description: >
    Generate 5-7 platform-optimized hook options based on {speaker}'s talk content.
    ===
    transcript: 
    {transcript}
    ===
    Create compelling opening lines that:
    - LinkedIn: Appeal to policymakers, industry leaders, tech professionals
    - Twitter/X: Target ML researchers, AI alignment professionals
    - LEAD WITH THE CORE INSIGHT IMMEDIATELY - no setup or context
    - Start with concrete, specific, counterintuitive findings
    - Avoid corporate speak ("researchers discovered that", "new framework")
    - State the surprising result first, attribution second
    - Use active voice and direct statements
    - Be punchy and immediate - grab attention in first 5 words
    - Include brief reasoning for why each hook would capture attention
    - Provide variety: different angles, approaches, and emphasis
  expected_output: >
    {
      "li_hooks": [
        {"text": "Most surprising finding hook", "reasoning": "Why this surprises professionals"},
        {"text": "Technical implications hook", "reasoning": "Why this matters for policy"},
        {"text": "Counterintuitive result hook", "reasoning": "Why this challenges assumptions"},
        {"text": "Practical impact hook", "reasoning": "Why this affects business/decisions"},
        {"text": "Research breakthrough hook", "reasoning": "Why this advances the field"}
      ],
      "x_hooks": [
        {"text": "Technical precision hook", "reasoning": "Why this interests ML researchers"},
        {"text": "Methodological innovation hook", "reasoning": "Why this matters for research"},
        {"text": "Surprising result hook", "reasoning": "Why this challenges current thinking"},
        {"text": "Alignment implication hook", "reasoning": "Why this matters for AI safety"},
        {"text": "Implementation insight hook", "reasoning": "Why this helps practitioners"}
      ]
    }
  context: ["analyze_transcript_task"]
  agent: hook_specialist_agent

create_li_content_task:
  description: >
    Create LinkedIn post content optimized for policymakers and tech professionals.
    ===
    transcript: 
    {transcript}
    ===
    style_shared: 
    {style_shared}
    ===
    style_li: 
    {style_li}
    ===
    Your content should:
    - Select the strongest LinkedIn hook from the 5 options and explain your choice
    - Write a tight 2-3 sentence paragraph summary suitable for non-ML professionals  
    - Use concise attribution format: "{speaker} ({affiliation}) presents..." not "from"
    - Create 3-4 bullet points (without ðŸ”¹ emoji) that are â‰¤ 8 words each
    - Focus on implications, applications, and broader significance
    - Maintain accessibility while preserving technical accuracy
    - Use FAR.AI's professional voice with speaker's factual content
  expected_output: >
    {
      "selected_hook": "Chosen hook with detailed selection reasoning",
      "paragraph_summary": "Tight 2-3 sentence summary for LinkedIn audience", 
      "bullets": ["â‰¤8 word bullet 1", "â‰¤8 word bullet 2", "â‰¤8 word bullet 3", "â‰¤8 word bullet 4"]
    }
  context: ["analyze_transcript_task", "generate_hooks_task"]
  agent: li_content_writer_agent

create_x_content_task:
  description: >
    Create Twitter/X thread content optimized for ML researchers and technical audiences.
    ===
    transcript: 
    {transcript}
    ===
    style_shared: 
    {style_shared}
    ===
    style_x: 
    {style_x}
    ===
    Your content should:
    - Select the strongest X hook from the 5 options and explain your choice
    - Write ULTRA-DENSE tweet content that packs maximum insight into 280 chars
    - Use abbreviations: "w/" not "with", "&" not "and", numbers not words
    - Cut ALL unnecessary words - every character must add value
    - Include specific technical details, methods, and results
    - Target ML researchers who appreciate precision and nuance
    - Use FAR.AI's professional voice with speaker's technical accuracy
    - COUNT CHARACTERS - must be â‰¤280 including spaces and punctuation
  expected_output: >
    {
      "selected_hook": "Chosen hook with detailed selection reasoning",
      "x_content": "Complete optimized tweet content (hook + core findings)"
    }
  context: ["analyze_transcript_task", "generate_hooks_task"]
  agent: x_content_writer_agent

fact_check_content_task:
  description: >
    Verify all content claims against the original transcript for accuracy.
    ===
    ORIGINAL TRANSCRIPT (SOURCE OF TRUTH): 
    {transcript}
    ===
    SPEAKER: {speaker}
    EVENT: {event_name}
    ===
    Review the LinkedIn and Twitter/X content from previous tasks to ensure:
    - Every claim is supported by the transcript
    - Technical details and numbers are precisely accurate
    - No exaggerations or misrepresentations exist
    - Tone matches the speaker's original communication style
    - Content represents findings the speaker would endorse
    
    IF CONTENT FAILS ACCURACY CHECK:
    1. Rewrite the problematic sections using only verified transcript information
    2. Re-assess your corrections against the transcript
    3. Maximum 1 revision attempt to avoid loops
    4. If still failing after revision, reject with detailed notes
  expected_output: >
    {
      "accuracy_score": 9,
      "fact_issues": ["Issue description if any"],
      "technical_accuracy": "Assessment of numbers/methods accuracy", 
      "speaker_alignment": "Would speaker endorse this content?",
      "corrections_made": "Description of any corrections applied",
      "revised_li_content": "Corrected LinkedIn content (if revised)",
      "revised_x_content": "Corrected X content (if revised)",
      "approved_for_next_step": false
    }
    
    APPROVAL CRITERIA: Only approve (set approved_for_next_step: true) if:
    - Accuracy score is PERFECT 10/10 (no tolerance for inaccuracy)
    - Zero factual errors or misrepresentations 
    - Speaker would confidently endorse and reshare
    - All technical details are precisely correct
  context: ["create_li_content_task", "create_x_content_task"]
  agent: fact_checker_agent

voice_authenticity_check_task:
  description: >
    Ensure content uses FAR.AI's professional brand voice while being maximally concise and factually accurate.
    ===
    ORIGINAL TRANSCRIPT (FOR FACTUAL ACCURACY): 
    {transcript}
    ===
    SPEAKER: {speaker}
    AFFILIATION: {affiliation}
    ===
    Review the LinkedIn and Twitter/X content and fact check results from previous tasks.
    STEP 1 - FAR.AI BRAND VOICE:
    - Uses FAR.AI's conversational yet authoritative tone
    - Professional and credible, never mimicking speaker's personal style
    - Preserves speaker's exact technical terms and key insights for accuracy
    - Sounds like FAR.AI content, not a speaker quote
    - Maintains FAR.AI's brand consistency and standards
    
    STEP 2 - MAXIMUM CONCISENESS:
    - Cut every unnecessary word ruthlessly
    - Tighten sentence structure for maximum impact
    - LinkedIn: <150 words total, bullets â‰¤8 words each
    - Twitter/X: Maximize information density, eliminate fluff
    - Every word must earn its place - no exceptions
    
    IF CONTENT FAILS:
    1. Rewrite in FAR.AI's professional voice using factual content
    2. Cut wordiness aggressively while preserving meaning
    3. Re-assess both brand voice and conciseness
    4. Maximum 1 revision attempt to avoid loops
  expected_output: >
    {
      "brand_voice_score": 9,
      "conciseness_score": 9,
      "brand_voice_assessment": "Does this sound like professional FAR.AI content?",
      "conciseness_assessment": "Content is maximally tight and impactful?",
      "far_ai_would_publish": true,
      "corrections_made": "Description of brand voice and conciseness corrections applied",
      "revised_li_content": "FAR.AI-voiced and maximally concise LinkedIn content (if revised)",
      "revised_x_content": "FAR.AI-voiced and maximally concise X content (if revised)",
      "approved_for_next_step": false
    }
    
    APPROVAL CRITERIA: Only approve (set approved_for_next_step: true) if:
    - Brand voice score is 9/10 or higher (FAR.AI professional tone)
    - Conciseness score is 9/10 or higher (maximum tightness)
    - FAR.AI would confidently publish this content
    - Content sounds like FAR.AI, not speaker mimicry
    - LinkedIn <150 words, bullets â‰¤8 words each
    - Zero unnecessary words remain
  context: ["create_li_content_task", "create_x_content_task", "fact_check_content_task"]
  agent: voice_checker_agent

compliance_audit_task:
  description: >
    Audit content for style compliance and assemble final publication-ready posts.
    ===
    style_shared: 
    {style_shared}
    ===
    style_li: 
    {style_li}
    ===
    style_x: 
    {style_x}
    ===
    Review the LinkedIn and Twitter/X content and all quality control results from previous tasks.
    STEP 1 - COMPLIANCE AUDIT:
    - Emoji usage (only ðŸ”¹ ðŸ‘‡ â–¶ï¸ ðŸ“„ in designated places)
    - Character limits and word counts
    - Structural requirements (hook, paragraph, bullets, CTA)
    - Attribution and event mention rules
    - 14-point rubric scoring
    - Style guide violations
    
    STEP 2 - CONTENT ASSEMBLY:
    - Combine approved components using FAR.AI templates
    - LinkedIn: Hook + Paragraph + Bullets + CTA + First Comment
    - Twitter/X: Optimized content + CTA with links
    - Apply proper formatting and structure
    
    IF COMPLIANCE FAILS:
    1. Fix format violations (emojis, structure, character counts)
    2. Re-audit against style guide requirements
    3. Assemble only if fully compliant
    4. Maximum 1 revision attempt to avoid loops
  expected_output: >
    {
      "li_compliance_score": 14,
      "x_compliance_score": 14,
      "style_violations": ["Violation description if any"],
      "rubric_breakdown": {
        "content_quality": 8,
        "style_quality": 6,
        "specific_scores": "Detailed breakdown"
      },
      "corrections_made": "Description of compliance fixes applied",
      "li_hook": "Final LinkedIn hook",
      "paragraph_summary": "Final paragraph summary",
      "bullets": ["Final bullet 1", "Final bullet 2", "Final bullet 3"],
      "x_content": "Final Twitter/X content",
      "approved_for_final_review": false
    }
    
    APPROVAL CRITERIA: Only approve (set approved_for_final_review: true) if:
    - Both LinkedIn AND X scores are perfect 14/14
    - Zero style guide violations
    - Zero compliance issues
    - Content exceeds professional publication standards
    - Assembly completed successfully
  context: ["create_li_content_task", "create_x_content_task", "fact_check_content_task", "voice_authenticity_check_task"]
  agent: compliance_auditor_agent


final_review_task:
  description: >
    Make final publication decision based on all quality control reports.
    ===
    ORIGINAL TRANSCRIPT (FOR FINAL ACCURACY CHECK): 
    {transcript}
    ===
    STYLE GUIDES (FOR FINAL COMPLIANCE CHECK):
    {style_shared}
    
    {style_li}
    
    {style_x}
    ===
    SPEAKER: {speaker}
    EVENT: {event_name}
    AFFILIATION: {affiliation}
    ===
    Review the final assembled content and all quality control outputs from previous tasks.
    Review all previous quality control outputs:
    - Fact checking results and accuracy scores
    - Voice authenticity assessment
    - Style guide compliance audit
    - Assembled post quality
    - Overall readiness for publication
    
    PUBLICATION STANDARDS (VERY HIGH BAR):
    - Accuracy score must be 10/10 or higher
    - Voice match score must be 8/10 or higher  
    - Compliance score must be 14/14 (perfect)
    - Zero blocking issues allowed
    - Speaker must be willing to reshare (confident assessment)
    - Content must exceed industry standards for research communication
    
    Reject content that doesn't meet these strict criteria. FAR.AI's reputation depends on exceptional quality.
  expected_output: >
    {
      "li_hook": "Final approved LinkedIn hook",
      "paragraph_summary": "Final approved summary paragraph",
      "bullets": ["Final bullet 1", "Final bullet 2", "Final bullet 3"],
      "x_content": "Final approved Twitter/X content",
      "publication_decision": "APPROVED/NEEDS_REVISION",
      "final_quality_score": 14,
      "blocking_issues": [],
      "revision_notes": "Specific feedback if revision needed",
      "eval_notes": "Complete quality assessment and rubric breakdown"
    }
  context: ["create_li_content_task", "create_x_content_task", "fact_check_content_task", "voice_authenticity_check_task", "compliance_audit_task"]
  output_file: "output/{speaker}_final.json"
  agent: final_reviewer_agent