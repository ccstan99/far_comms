# All tasks follow style_shared.md, style_li.md, and style_x.md requirements
# Analysis now comes from prepare-talk via Analysis column - no need to re-analyze transcript

create_li_content_task:
  description: >
    Create LinkedIn content for policymakers and tech professionals, must be accessible to general, non-ML audience.
    Use the transcript analysis from prepare-talk and raw transcript for quotes.
    ===
    RAW TRANSCRIPT (for authentic hooks and quotes):
    {transcript}
    ---
    STRUCTURED ANALYSIS (from prepare-talk Analysis column):
    {analysis}
    ---    
    STYLE SHARED: 
    {style_shared}
    ---
    STYLE LI: 
    {style_li}
    ===
    Requirements:
    - Generate 5 potential LinkedIn hooks using raw transcript for authentic voice and direct quotes
    - Select the strongest hook that will grab attention from policymakers/industry leaders
    - Use structured analysis (key_findings, surprising_claims) for paragraph content foundation
    - Incorporate direct quotes from raw transcript where impactful
    - Ensure hook/paragraph cohesion (no repetitive phrases)
    - Write 2-3 sentence paragraph starting with "@{speaker} ({affiliation}) [verb]" format, then key_findings and surprising_claims - explain technical concepts in plain language accessible to general business audience
    - Create 3-4 bullets ≤8 words each using technical_details (complement, don't repeat content)
    - Focus on implications, applications, broader significance from key_findings
  expected_output: >
    {
      "generated_hooks": ["Hook option 1", "Hook option 2", "Hook option 3", "Hook option 4", "Hook option 5"],
      "selected_hook": "Chosen hook text",
      "selection_reasoning": "Why this hook was selected over the others",
      "paragraph_summary": "2-3 sentence summary", 
      "bullets": ["≤8 word bullet 1", "≤8 word bullet 2", "≤8 word bullet 3"]
    }
  agent: li_content_writer_agent

create_x_content_task:
  description: >
    Create Twitter/X content for ML researchers.
    Use the transcript analysis from prepare-talk and raw transcript for technical precision.
    ===
    RAW TRANSCRIPT (for authentic hooks and technical precision):
    {transcript}
    ---
    STRUCTURED ANALYSIS (from prepare-talk Analysis column):
    {analysis}
    ---
    SPEAKER INFO:
    - Speaker X handle: {speaker_x_handle}
    ---    
    STYLE SHARED: 
    {style_shared}
    ---
    STYLE X: 
    {style_x}
    ===
    Requirements:
    - Generate 5 potential Twitter/X hooks using raw transcript for technical precision and authentic quotes
    - Select the strongest hook that will grab attention from ML researchers
    - Use structured analysis (technical_details, surprising_claims) for content foundation
    - Extract specific numbers, methods, and results directly from raw transcript
    - Write ULTRA-DENSE tweet, every character adds value
    - Use abbreviations: w/, &, numbers not words
    - MUST include speaker attribution: if {speaker_x_handle} contains @ symbol, use it directly; otherwise use speaker name
    - Target ML researchers who appreciate precision and authenticity
  expected_output: >
    {
      "generated_hooks": ["Hook option 1", "Hook option 2", "Hook option 3", "Hook option 4", "Hook option 5"],
      "x_content": "Tweet1 content (including selected hook)"
    }
  agent: x_content_writer_agent

fact_check_content_task:
  description: >
    Verify all content claims against original transcript and provide corrected versions.
    ===
    {speaker} ({affiliation}) transcript from {event_name}: 
    {transcript}
    ===
    PROCESS:
    1. Check every claim against transcript for accuracy
    2. Identify any exaggerations, unsupported claims, or technical errors
    3. If accuracy issues found, rewrite problematic sections using only verified transcript information
    4. Ensure speaker would endorse all final content
    5. Output corrected content versions
    
    ACCURACY SCORING CRITERIA (1-5):
    - 5: Perfect accuracy - all claims directly supported by transcript
    - 4: High accuracy with minor, acceptable simplifications for readability
    - 3: Generally accurate but some claims need verification or correction
    - 2: Multiple accuracy issues requiring significant corrections
    - 1: Major factual errors, misrepresentations, or unsupported claims
  expected_output: >
    {
      "accuracy_score": "1-5 scale based on factual correctness",
      "corrections_made": "Description of any corrections applied to fix accuracy issues",
      "corrected_li_hook": "Final accurate LinkedIn hook",
      "corrected_li_paragraph": "Final accurate paragraph summary", 
      "corrected_li_bullets": ["Accurate bullet 1", "Accurate bullet 2", "Accurate bullet 3"],
      "corrected_x_content": "Final accurate Twitter/X hook + content",
      "approved_for_next_step": "true/false based on accuracy threshold"
    }
    
    APPROVAL CRITERIA: Only approve (set approved_for_next_step: true) if:
    - Accuracy score is 4/5 or higher (5/5 if perfect, 4/5 with minor simplifications acceptable)
    - No major factual errors or misrepresentations of core findings
    - Content represents speaker's research fairly and accurately
    - Technical details are substantially correct (minor simplifications acceptable for platform constraints)
  context: ["create_li_content_task", "create_x_content_task"]
  agent: fact_checker_agent


voice_authenticity_check_task:
  description: >
    Apply FAR.AI brand voice and maximum conciseness to fact-checked content 
    for social media posts for {speaker} ({affiliation}) talk from {event_name}.
    ===
    PROCESS:
    1. Take the corrected content from fact_check_content_task (accuracy verified)
    2. Apply FAR.AI brand voice: conversational yet authoritative, maximally concise
    3. Cut unnecessary words ruthlessly while preserving accuracy
    4. Ensure professional tone and brand consistency
    5. LinkedIn <150 words, bullets ≤8 words each
    
    SCORING CRITERIA:
    Brand Voice Score (1-5):
    - 5: Natural, engaging, authentic FAR.AI voice - conversational yet intelligent
    - 4: Strong voice with minor improvements needed
    - 3: Acceptable but somewhat generic or formulaic
    - 2: Generic AI-generated tone, lacks personality
    - 1: Robotic, corporate fluff, sounds obviously AI-generated
    
    Conciseness Score (1-5):
    - 5: Every word adds value, maximum information density
    - 4: Highly concise with minimal waste
    - 3: Generally tight with some unnecessary words
    - 2: Moderate wordiness, clear cuts possible
    - 1: Wordy and inefficient, significant trimming needed
  expected_output: >
    {
      "brand_voice_score": "1-5 scale based on FAR.AI voice quality",
      "conciseness_score": "1-5 scale based on word efficiency",
      "voice_corrections_made": "Description of brand voice and conciseness improvements applied",
      "final_li_hook": "FAR.AI-voiced LinkedIn hook",
      "final_li_paragraph": "FAR.AI-voiced paragraph summary", 
      "final_li_bullets": ["FAR.AI-voiced bullet 1", "FAR.AI-voiced bullet 2", "FAR.AI-voiced bullet 3"],
      "final_x_content": "FAR.AI-voiced Twitter/X core hook + content",
      "approved_for_next_step": true or false
    }
    
    APPROVAL CRITERIA: Only approve (set approved_for_next_step: true) if:
    - Brand voice score is 4/5 or higher (natural, engaging FAR.AI voice)
    - Conciseness score is 4/5 or higher (maximum tightness)
    - FAR.AI would confidently publish this content
    - Content sounds like FAR.AI, not speaker mimicry
    - LinkedIn <150 words, bullets ≤8 words each
    - 0 unnecessary words remain
  context: ["create_li_content_task", "create_x_content_task", "fact_check_content_task"]
  agent: voice_checker_agent


final_review_task:
  description: >
    Audit compliance, assemble final posts, and make publication decisions.
    ===
    ORIGINAL TRANSCRIPT (FOR FINAL ACCURACY CHECK): 
    {transcript}
    ===
    STYLE GUIDES (FOR COMPLIANCE AUDIT):
    {style_shared}
    
    {style_li}
    
    {style_x}
    ===
    ASSEMBLY VARIABLES:
    yt_full_link: {yt_full_link}
    resource_url: {resource_url}
    event_name: {event_name}
    speaker: {speaker}
    affiliation: {affiliation}
    ===
    PROCESS:
    1. COMPLIANCE AUDIT & FIX: Systematically check content against 14-point rubric
       - CRITICAL: Scan for em dashes (—) and hyphens (-) except in names, replace with appropriate punctuation
       - Fix emoji usage, character limits, structural requirements, and formatting violations
       - Score each of 14 rubric points: pass/fail for each specific requirement
       - Make multiple improvement passes to maximize compliance score
    
    2. ASSEMBLY: Create complete LinkedIn and Twitter/X posts using templates
       - Replace [video_url] with {yt_full_link}
       - Replace [resource_url] with {resource_url}
       - Replace {event_name} in CTA text
       - For Twitter/X: Include speaker attribution using {speaker_x_handle}
    
    3. CRITICAL FINAL CHECKS:
       - **Accuracy Check**: Compare every claim against original transcript - do ALL statements match what speaker actually said?
       - **Speaker Approval Check**: Would the speaker confidently reshare this content as accurate representation of their work?
    
    4. ADDITIONAL VALIDATION:
       - Verify all claims, numbers, and technical details are supported by transcript
       - Ensure no hallucinations or interpretations were introduced during processing
       - Continue improving content until no further improvements possible without introducing errors
    
    PUBLICATION STANDARDS:
    - Both critical checks must be ✓ for APPROVED decision
    - Any ✗ requires NEEDS_REVISION with specific explanation
    - Make final corrections if minor issues found
    - Focus on binary go/no-go decision, not detailed scoring
    
    CRITICAL PROHIBITIONS (IMMEDIATE REJECTION):
    - NEVER suggest hashtags (absolutely prohibited in style guide) - ANY hashtag suggestions = AUTOMATIC REJECTION
    - NEVER advocate for positions or suggest CTAs asking for opinions
    - Content must remain neutral and factual
    - Scan all content for # symbols and reject immediately if found
    
    DECISION LOGIC:
    - Accuracy Check ✓ AND Speaker Approval Check ✓ = "APPROVED"
    - Either check ✗ = "NEEDS_REVISION" with specific feedback
    - Hashtags or position advocacy = "REJECTED" (immediate disqualification)
    
    Reject content that doesn't meet these strict criteria. FAR.AI's reputation depends on exceptional quality.
  expected_output: >
    {
      "paragraph_ai": "Final approved summary paragraph",
      "li_content": "Final approved complete LinkedIn post",
      "x_content": "Final approved complete Twitter/X content",
      "notes": {
        "publication_decision": "APPROVED/NEEDS_REVISION/REJECTED/NEEDS_MANUAL_REVIEW",
        "accuracy_check": "✓/✗ with explanation - confirm all claims match transcript",
        "speaker_approval_check": "✓/✗ with explanation - would speaker consider accurate and reshare?",
        "compliance_score_review": "X/14 based on actual style guide compliance assessment",
        "blocking_issues": [],
        "revision_notes": "Specific feedback if revision needed",
        "cohesion_assessment": "Final assessment of content cohesion and flow",
        "transcript_analysis": "Transcript analysis from prepare-talk Analysis column"
      }
      }
    }
  context: ["create_li_content_task", "create_x_content_task", "fact_check_content_task", "voice_authenticity_check_task"]
  output_file: "output/{speaker}_final.json"
  agent: final_reviewer_agent