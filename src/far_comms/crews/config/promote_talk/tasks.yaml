# All tasks follow style_shared.md, style_li.md, and style_x.md requirements

analyze_transcript_task:
  description: >
    Analyze {speaker}'s talk transcript to extract core findings, technical details, and key insights.
    ===
    transcript: 
    {transcript}
    ===
    Your analysis should:
    - Identify the main thesis and supporting arguments
    - Extract specific technical details, numbers, and metrics
    - Find surprising or counterintuitive claims
    - Collect impactful direct quotes from the speaker
    - Note the speaker's communication style and tone
    - Highlight key findings that would interest both technical and non-technical audiences
  expected_output: >
    {
      "core_thesis": "Main argument in 1 sentence",
      "key_findings": ["Finding 1", "Finding 2", "Finding 3"],
      "technical_details": {"metrics": ["...", "..."], "methods": ["...", "..."], "numbers": ["...", "..."]},
      "surprising_claims": ["Counterintuitive insight 1", "Counterintuitive insight 2"],
      "impactful_quotes": ["Direct quote 1", "Direct quote 2"],
      "speaker_voice": "Description of communication style and tone characteristics"
    }
  agent: transcript_analyzer_agent

generate_hooks_task:
  description: >
    Generate 5-7 platform-optimized hook options based on {speaker}'s talk content.
    ===
    transcript: 
    {transcript}
    ===
    Create compelling opening lines that:
    - LinkedIn: Appeal to policymakers, industry leaders, tech professionals
    - Twitter/X: Target ML researchers, AI alignment professionals
    - LEAD WITH THE CORE INSIGHT IMMEDIATELY - no setup or context
    - Start with concrete, specific, counterintuitive findings
    - Avoid corporate speak ("researchers discovered that", "new framework")
    - State the surprising result first, attribution second
    - Use active voice and direct statements
    - Be punchy and immediate - grab attention in first 5 words
    - Include brief reasoning for why each hook would capture attention
    - Provide variety: different angles, approaches, and emphasis
  expected_output: >
    {
      "li_hooks": [
        {"text": "Most surprising finding hook", "reasoning": "Why this surprises professionals"},
        {"text": "Technical implications hook", "reasoning": "Why this matters for policy"},
        {"text": "Counterintuitive result hook", "reasoning": "Why this challenges assumptions"},
        {"text": "Practical impact hook", "reasoning": "Why this affects business/decisions"},
        {"text": "Research breakthrough hook", "reasoning": "Why this advances the field"}
      ],
      "x_hooks": [
        {"text": "Technical precision hook", "reasoning": "Why this interests ML researchers"},
        {"text": "Methodological innovation hook", "reasoning": "Why this matters for research"},
        {"text": "Surprising result hook", "reasoning": "Why this challenges current thinking"},
        {"text": "Alignment implication hook", "reasoning": "Why this matters for AI safety"},
        {"text": "Implementation insight hook", "reasoning": "Why this helps practitioners"}
      ]
    }
  context: ["analyze_transcript_task"]
  agent: hook_specialist_agent

create_li_content_task:
  description: >
    Create LinkedIn content for policymakers and tech professionals using common style requirements.
    ===
    transcript: {transcript}
    style_shared: {style_shared}
    style_li: {style_li}
    ===
    Requirements:
    - Select strongest hook from 5 options (explain choice)
    - Ensure hook/paragraph cohesion (no repetitive phrases)
    - Write 2-3 sentence paragraph for non-ML professionals
    - Create 3-4 bullets ≤8 words each (complement, don't repeat content)
    - Focus on implications, applications, broader significance
  expected_output: >
    {
      "selected_hook": "Chosen hook + reasoning",
      "paragraph_summary": "2-3 sentence summary", 
      "bullets": ["≤8 word bullet 1", "≤8 word bullet 2", "≤8 word bullet 3"]
    }
  context: ["analyze_transcript_task", "generate_hooks_task"]
  agent: li_content_writer_agent

create_x_content_task:
  description: >
    Create Twitter/X content for ML researchers using common style requirements.
    ===
    transcript: {transcript}
    style_shared: {style_shared}
    style_x: {style_x}
    ===
    Requirements:
    - Select strongest hook from 5 options (explain choice)  
    - Write ULTRA-DENSE tweet, every character adds value
    - Use abbreviations: w/, &, numbers not words
    - Include specific technical details, methods, results
    - Target ML researchers who appreciate precision
  expected_output: >
    {
      "selected_hook": "Chosen hook + reasoning",
      "x_content": "Complete tweet content"
    }
  context: ["analyze_transcript_task", "generate_hooks_task"]
  agent: x_content_writer_agent

fact_check_content_task:
  description: >
    Verify all content claims against original transcript.
    ===
    TRANSCRIPT: {transcript}
    SPEAKER: {speaker}
    EVENT: {event_name}
    ===
    Ensure every claim is supported, technical details accurate, no exaggerations.
    Speaker should endorse all content. Rewrite problematic sections once if needed.
  expected_output: >
    {
      "accuracy_score": 9,
      "fact_issues": ["Issue description if any"],
      "technical_accuracy": "Assessment of numbers/methods accuracy", 
      "speaker_alignment": "Would speaker endorse this content?",
      "corrections_made": "Description of any corrections applied",
      "revised_li_content": "Corrected LinkedIn content (if revised)",
      "revised_x_content": "Corrected X content (if revised)",
      "approved_for_next_step": false
    }
    
    APPROVAL CRITERIA: Only approve (set approved_for_next_step: true) if:
    - Accuracy score is PERFECT 10/10 (no tolerance for inaccuracy)
    - Zero factual errors or misrepresentations 
    - Speaker would confidently endorse and reshare
    - All technical details are precisely correct
  context: ["create_li_content_task", "create_x_content_task"]
  agent: fact_checker_agent

voice_authenticity_check_task:
  description: >
    Ensure FAR.AI brand voice and maximum conciseness using common style requirements.
    ===
    TRANSCRIPT: {transcript}
    SPEAKER: {speaker}
    AFFILIATION: {affiliation}
    ===
    Check: FAR.AI tone (not speaker mimicry), conciseness (LinkedIn <150 words, bullets ≤8 words).
    Cut unnecessary words ruthlessly. Rewrite once if needed.
  expected_output: >
    {
      "brand_voice_score": 9,
      "conciseness_score": 9,
      "brand_voice_assessment": "Does this sound like professional FAR.AI content?",
      "conciseness_assessment": "Content is maximally tight and impactful?",
      "far_ai_would_publish": true,
      "corrections_made": "Description of brand voice and conciseness corrections applied",
      "revised_li_content": "FAR.AI-voiced and maximally concise LinkedIn content (if revised)",
      "revised_x_content": "FAR.AI-voiced and maximally concise X content (if revised)",
      "approved_for_next_step": false
    }
    
    APPROVAL CRITERIA: Only approve (set approved_for_next_step: true) if:
    - Brand voice score is 9/10 or higher (FAR.AI professional tone)
    - Conciseness score is 9/10 or higher (maximum tightness)
    - FAR.AI would confidently publish this content
    - Content sounds like FAR.AI, not speaker mimicry
    - LinkedIn <150 words, bullets ≤8 words each
    - Zero unnecessary words remain
  context: ["create_li_content_task", "create_x_content_task", "fact_check_content_task"]
  agent: voice_checker_agent

compliance_audit_task:
  description: >
    Audit content from previous tasks using common style requirements, then assemble final posts.
    ===
    style_shared: {style_shared}
    style_li: {style_li}
    style_x: {style_x}
    ===
    yt_full_link: {yt_full_link}
    resource_url: {resource_url}
    event_name: {event_name}
    ===
    Process:
    1. AUDIT: Check compliance against style guides, structure, attribution, 14-point rubric
       - CRITICAL: Scan for em dashes (—) and hyphens (-) except in names - replace with periods/commas
    2. ASSESS: Evaluate hook/paragraph/bullets cohesion, ensure no repetitive phrasing
    3. ASSEMBLE: Create final LinkedIn and Twitter/X posts using FAR.AI templates
       - Replace [video_url] with {yt_full_link}
       - Replace [resource_url] with {resource_url} 
       - Replace {event_name} in CTA text with actual event name
    
    Fix violations once if needed, assemble only when fully compliant.
  expected_output: >
    {
      "li_compliance_score": 14,
      "x_compliance_score": 14,
      "style_violations": ["Violation description if any"],
      "rubric_breakdown": {
        "content_quality": 8,
        "style_quality": 6,
        "specific_scores": "Detailed breakdown"
      },
      "corrections_made": "Description of compliance fixes applied",
      "cohesion_assessment": "Assessment of how well hook/paragraph/bullets work together without repetition",
      "components": {
        "li_hook": "Final LinkedIn hook",
        "paragraph_summary": "Final paragraph summary",
        "bullets": ["Final bullet 1", "Final bullet 2", "Final bullet 3"],
        "x_content_core": "Final Twitter/X content without CTA"
      },
      "assembled_content": {
        "li_content": "Complete LinkedIn post: hook + paragraph + bullets + CTA + first comment",
        "x_content": "Complete Twitter/X content: core content + CTA + links"
      },
      "approved_for_final_review": false
    }
    
    APPROVAL CRITERIA: Only approve (set approved_for_final_review: true) if:
    - Both LinkedIn AND X scores are perfect 14/14
    - Zero style guide violations
    - Zero compliance issues
    - Content exceeds professional publication standards
    - Assembly completed successfully
  context: ["create_li_content_task", "create_x_content_task", "fact_check_content_task", "voice_authenticity_check_task"]
  agent: compliance_auditor_agent


final_review_task:
  description: >
    Make final publication decision based on all quality control reports.
    ===
    ORIGINAL TRANSCRIPT (FOR FINAL ACCURACY CHECK): 
    {transcript}
    ===
    STYLE GUIDES (FOR FINAL COMPLIANCE CHECK):
    {style_shared}
    
    {style_li}
    
    {style_x}
    ===
    SPEAKER: {speaker}
    EVENT: {event_name}
    AFFILIATION: {affiliation}
    ===
    Review the final assembled content and all quality control outputs from previous tasks.
    Review all previous quality control outputs:
    - Fact checking results and accuracy scores
    - Voice authenticity assessment
    - Style guide compliance audit
    - Assembled post quality
    - Overall readiness for publication
    
    PUBLICATION STANDARDS (VERY HIGH BAR):
    - Accuracy score must be 10/10 or higher
    - Voice match score must be 8/10 or higher  
    - Compliance score must be 14/14 (perfect)
    - Zero blocking issues allowed
    - Speaker must be willing to reshare (confident assessment)
    - Content must exceed industry standards for research communication
    
    Reject content that doesn't meet these strict criteria. FAR.AI's reputation depends on exceptional quality.
  expected_output: >
    {
      "components": {
        "li_hook": "Final approved LinkedIn hook",
        "paragraph_summary": "Final approved summary paragraph",
        "bullets": ["Final bullet 1", "Final bullet 2", "Final bullet 3"],
        "x_content_core": "Final approved Twitter/X core content"
      },
      "assembled_content": {
        "li_content": "Final approved complete LinkedIn post",
        "x_content": "Final approved complete Twitter/X content"
      },
      "publication_decision": "APPROVED/NEEDS_REVISION",
      "final_quality_score": 14,
      "blocking_issues": [],
      "revision_notes": "Specific feedback if revision needed", 
      "eval_notes": "Complete quality assessment and rubric breakdown",
      "cohesion_assessment": "Final assessment of content cohesion and flow"
    }
  context: ["create_li_content_task", "create_x_content_task", "fact_check_content_task", "voice_authenticity_check_task", "compliance_audit_task"]
  output_file: "output/{speaker}_final.json"
  agent: final_reviewer_agent